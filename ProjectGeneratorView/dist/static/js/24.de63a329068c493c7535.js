(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{Yfch:function(e,t,i){"use strict";function n(e){return/^ROLE_[A-Z]+$/.test(e)}function s(e){return!0}function o(e){return!0}function l(e){return/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/.test(e)}i.d(t,"d",function(){return n}),i.d(t,"c",function(){return s}),i.d(t,"a",function(){return o}),i.d(t,"b",function(){return l})},bDWH:function(e,t,i){"use strict";i.r(t);var n=i("QbLZ"),s=i.n(n),o=i("t3Un"),l=i("Yfch"),a=i("L2JU"),r={created:function(){this.hasPermission("role:update")&&this.getAllPermission(),this.hasPermission("role:list")&&this.getRoleList()},data:function(){return{roleList:[],allPermission:[],listLoading:!1,total:0,listQuery:{page:1,size:30},dialogStatus:"add",dialogFormVisible:!1,textMap:{update:"Update Role Permission",add:"Add Role"},btnLoading:!1,tempRole:{id:"",name:"",permissionIdList:[]},createRules:{name:[{required:!0,trigger:"blur",validator:function(e,t,i){Object(l.d)(t)?i():i(new Error("role name format error. eg. ROLE_ABC"))}}]}}},computed:s()({},Object(a.b)(["roleName"])),methods:{getAllPermission:function(){var e=this;Object(o.a)({url:"/permission",method:"get",params:void 0}).then(function(t){e.allPermission=t.data.list})},getRoleList:function(){var e,t=this;this.listLoading=!0,(e=this.listQuery,Object(o.a)({url:"/role",method:"get",params:e})).then(function(e){t.roleList=e.data.list,t.total=e.data.total,t.listLoading=!1})},handleSizeChange:function(e){this.listQuery.page=1,this.listQuery.size=e,this.getRoleList()},handleCurrentChange:function(e){this.listQuery.page=e,this.getRoleList()},getTableIndex:function(e){return(this.listQuery.page-1)*this.listQuery.size+e+1},showAddRoleDialog:function(){this.dialogFormVisible=!0,this.dialogStatus="add",this.tempRole.name="",this.tempRole.id="",this.tempRole.permissionIdList=[]},showUpdateRoleDialog:function(e){this.dialogFormVisible=!0,this.dialogStatus="update";var t=this.roleList[e];this.tempRole.name=t.name,this.tempRole.id=t.id,this.tempRole.permissionIdList=[];for(var i=0;i<t.resourceList.length;i++)for(var n=t.resourceList[i].handleList,s=0;s<n.length;s++){var o=n[s];this.tempRole.permissionIdList.push(o.id)}},addRole:function(){var e=this;this.$refs.tempRole.validate(function(t){var i;t&&e.isRoleNameUnique(e.tempRole.id,e.tempRole.name)?(e.btnLoading=!0,(i=e.tempRole,Object(o.a)({url:"/role",method:"post",data:i})).then(function(){e.$message.success("Add success"),e.getRoleList(),e.dialogFormVisible=!1,e.btnLoading=!1})):console.log("form not validate")})},updateRole:function(){var e=this;this.$refs.tempRole.validate(function(t){var i;t&&e.isRoleNameUnique(e.tempRole.id,e.tempRole.name)?(e.btnLoading=!0,(i=e.tempRole,Object(o.a)({url:"/role",method:"put",data:i})).then(function(){e.$message.success("Update success"),e.getRoleList(),e.dialogFormVisible=!1,e.btnLoading=!1})):console.log("form not validate")})},isRoleNameUnique:function(e,t){for(var i=0;i<this.roleList.length;i++)if(this.roleList[i].id!==e&&this.roleList[i].name===t)return this.$message.error("Role name already existed"),!1;return!0},removeRole:function(e){var t=this;this.$confirm("Delete this role?","Waring",{confirmButtonText:"yes",cancelButtonText:"no",showCancelButton:!1,type:"warning"}).then(function(){(function(e){return Object(o.a)({url:"/role/"+e,method:"delete"})})(t.roleList[e].id).then(function(){t.$message.success("Delete success!"),t.getRoleList()})})},isMenuNone:function(e){for(var t=this.allPermission[e].handleList,i=0;i<t.length;i++)if(this.tempRole.permissionIdList.indexOf(t[i].id)>-1)return!1;return!0},isMenuAll:function(e){for(var t=this.allPermission[e].handleList,i=0;i<t.length;i++)if(this.tempRole.permissionIdList.indexOf(t[i].id)<0)return!1;return!0},checkAll:function(e){this.isMenuAll(e)?this.cancelAll(e):this.selectAll(e)},selectAll:function(e){for(var t=this.allPermission[e].handleList,i=0;i<t.length;i++)this.addUnique(t[i].id,this.tempRole.permissionIdList)},cancelAll:function(e){for(var t=this.allPermission[e].handleList,i=0;i<t.length;i++){var n=this.tempRole.permissionIdList.indexOf(t[i].id);n>-1&&this.tempRole.permissionIdList.splice(n,1)}},handleChecked:function(e,t){this.tempRole.permissionIdList.indexOf(e.id)>-1?this.makePermissionChecked(t):this.cancelAll(t)},makePermissionChecked:function(e){for(var t=this.allPermission[e].handleList,i=0;i<t.length;i++)this.addUnique(t[i].id,this.tempRole.permissionIdList)},addUnique:function(e,t){t.indexOf(e)<0&&t.push(e)}}},d=i("KHd+"),u=Object(d.a)(r,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"app-container"},[i("div",{staticClass:"filter-container"},[i("el-form",[i("el-form-item",[e.hasPermission("role:list")?i("el-button",{attrs:{type:"success",icon:"el-icon-refresh"},nativeOn:{click:function(t){return t.preventDefault(),e.getRoleList(t)}}},[e._v("refresh\n        ")]):e._e(),e._v(" "),e.hasPermission("role:add")?i("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},nativeOn:{click:function(t){return t.preventDefault(),e.showAddRoleDialog(t)}}},[e._v("add\n        ")]):e._e()],1)],1)],1),e._v(" "),i("el-table",{directives:[{name:"loading",rawName:"v-loading.body",value:e.listLoading,expression:"listLoading",modifiers:{body:!0}}],attrs:{data:e.roleList,"element-loading-text":"loading",border:"",fit:"","highlight-current-row":""}},[i("el-table-column",{attrs:{label:"#",align:"center",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",{domProps:{textContent:e._s(e.getTableIndex(t.$index))}})]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"Role Name",align:"center",prop:"name"}}),e._v(" "),i("el-table-column",{attrs:{label:"Permission",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return["ROLE_ADMIN"===t.row.name?i("el-tag",{attrs:{type:"success"}},[e._v("all\n        ")]):0===t.row.resourceList.length?i("el-tag",{attrs:{type:"success"}},[e._v("none\n        ")]):e._l(t.row.resourceList,function(t){return i("div",[i("span",{staticStyle:{"margin-right":"3px"}},[e._v(e._s(t.resource))]),e._v(" "),e._l(t.handleList,function(t){return i("span",{staticStyle:{"margin-right":"3px"}},[i("el-tag",{attrs:{type:"success"},domProps:{textContent:e._s(t.handle)}})],1)})],2)})]}}])}),e._v(" "),e.hasPermission("role:update")||e.hasPermission("role:delete")?i("el-table-column",{attrs:{label:"Admin",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.hasPermission("role:update")&&"ROLE_ADMIN"!==t.row.name?i("el-button",{attrs:{type:"primary",icon:"el-icon-edit-outline"},on:{click:function(i){return e.showUpdateRoleDialog(t.$index)}}},[e._v("update\n        ")]):e._e(),e._v(" "),e.hasPermission("role:delete")&&"ROLE_ADMIN"!==t.row.name?i("el-button",{attrs:{type:"danger",icon:"el-icon-delete"},on:{click:function(i){return e.removeRole(t.$index)}}},[e._v("delete\n        ")]):e._e()]}}])}):e._e()],1),e._v(" "),i("el-pagination",{attrs:{"current-page":e.listQuery.page,"page-size":e.listQuery.size,total:e.total,"page-sizes":[10,30,50,100],layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),e._v(" "),i("el-dialog",{attrs:{title:e.textMap[e.dialogStatus],visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[i("el-form",{ref:"tempRole",staticClass:"small-space",staticStyle:{width:"500px","margin-left":"50px"},attrs:{"status-icon":"","label-position":"left","label-width":"100px",model:e.tempRole,rules:e.createRules}},[i("el-form-item",{attrs:{label:"Role name",prop:"name",required:""}},[i("el-input",{attrs:{type:"text","prefix-icon":"el-icon-edit","auto-complete":"off"},model:{value:e.tempRole.name,callback:function(t){e.$set(e.tempRole,"name",t)},expression:"tempRole.name"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"Permission",required:""}},e._l(e.allPermission,function(t,n){return i("div",[i("el-button",{attrs:{size:"mini",type:e.isMenuNone(n)?"":e.isMenuAll(n)?"success":"primary"},on:{click:function(t){return e.checkAll(n)}}},[e._v(e._s(t.resource)+"\n          ")]),e._v(" "),i("el-checkbox-group",{model:{value:e.tempRole.permissionIdList,callback:function(t){e.$set(e.tempRole,"permissionIdList",t)},expression:"tempRole.permissionIdList"}},e._l(t.handleList,function(t){return i("el-checkbox",{key:t.id,attrs:{label:t.id},on:{change:function(i){return e.handleChecked(t,e._index)}}},[i("span",[e._v(e._s(t.handle))])])}),1)],1)}),0)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("cancel")]),e._v(" "),"add"===e.dialogStatus?i("el-button",{attrs:{type:"success",loading:e.btnLoading},nativeOn:{click:function(t){return t.preventDefault(),e.addRole(t)}}},[e._v("add\n      ")]):i("el-button",{attrs:{type:"primary",loading:e.btnLoading},nativeOn:{click:function(t){return t.preventDefault(),e.updateRole(t)}}},[e._v("update\n      ")])],1)],1)],1)},[],!1,null,null,null);t.default=u.exports}}]);
//# sourceMappingURL=24.de63a329068c493c7535.js.map