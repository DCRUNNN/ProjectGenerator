(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{"+NnE":function(e,t,s){"use strict";s.d(t,"a",function(){return r}),s.d(t,"c",function(){return o}),s.d(t,"d",function(){return n}),s.d(t,"e",function(){return i}),s.d(t,"b",function(){return l});var a=s("t3Un");function r(e){return Object(a.a)({url:"/projectPhase/insert",method:"post",data:e})}function o(e){return Object(a.a)({url:"/projectPhase/getProjectPhaseList",method:"get",params:{projectId:e}})}function n(e){return Object(a.a)({url:"/projectPhase/getProjectPhaseTotal",method:"get",params:{projectId:e}})}function i(e){return Object(a.a)({url:"/projectPhase/updatePhase",method:"post",data:e})}function l(e,t,s){return Object(a.a)({url:"/projectPhase/deletePhase",method:"get",params:{phaseId:e,projectId:t,phase:s}})}},JNL0:function(e,t,s){"use strict";s.d(t,"d",function(){return r}),s.d(t,"e",function(){return o}),s.d(t,"f",function(){return n}),s.d(t,"a",function(){return i}),s.d(t,"h",function(){return l}),s.d(t,"b",function(){return c}),s.d(t,"c",function(){return u}),s.d(t,"g",function(){return d});var a=s("t3Un");function r(){return Object(a.a)({url:"/project/getAllProjects",method:"get"})}function o(e){return Object(a.a)({url:"/project/getProjectById",method:"get",params:{projectId:e}})}function n(e){return Object(a.a)({url:"/project/getProjectDetailById",method:"get",params:{projectId:e}})}function i(e){return Object(a.a)({url:"/project/insert",method:"post",data:e})}function l(e){return Object(a.a)({url:"/project/update",method:"post",data:e})}function c(e){return Object(a.a)({url:"/project/deleteProjectById",method:"get",params:{projectId:e}})}function u(e){return Object(a.a)({url:"/rateRange/deleteRateRange",method:"get",params:{rateRangeId:e}})}function d(e,t){return Object(a.a)({url:"/rateRange/getRateRange",method:"get",params:{projectId:e,investMoney:t}})}},KM5K:function(e,t,s){"use strict";s.r(t);var a=s("JNL0"),r=s("+NnE"),o=s("i7jY"),n={components:{},computed:{},watch:{projectId:function(e,t){e&&this.getInvestCustomersByProjectId(e)}},data:function(){return{projectId:"",projectName:"",phase:"",allProjectList:[],phaseList:[],phaseCustomerList:[],investCustomerList:[],listLoading:!1,customerListLoading:!1,dialogStatus:"add",dialogFormVisible:!1,btnLoading:!1,readonly:!1,tempPhase:{phaseId:"",projectId:"",phase:"",establishTime:"",payTime:""},createRules:{establishTime:[{required:!0,trigger:"blur",message:"请选择该期成立时间"}],payTime:[{required:!0,trigger:"blur",message:"请选择付息时间"}]}}},mounted:function(){this.projectId=parseInt(this.$route.params.projectId),this.projectId?(this.getPhaseByProjectId(),this.getAllProjectList()):(this.projectId="",this.getAllProjectList())},methods:{getAllProjectList:function(){var e=this;Object(a.d)().then(function(t){e.allProjectList=t.data})},getInvestCustomersByProjectId:function(e){var t=this;Object(o.d)(e).then(function(e){200===e.returnCode?t.investCustomerList=e.data:t.$message.error("获取客户列表失败，请刷新重试")})},getPhaseByProjectId:function(){var e=this;this.phaseCustomerList=[],this.listLoading=!0,this.phase="",Object(r.c)(this.projectId).then(function(t){e.phaseList=t.data,e.listLoading=!1})},getCustomersInPhase:function(){var e=this;this.customerListLoading=!0;var t=this.phaseList.filter(function(t){return t.phase===e.phase});this.phaseCustomerList=t[0].customerInPhaseList;for(var s=0;s<this.phaseCustomerList.length;s++)this.phaseCustomerList[s].customerName=this.getCustomerName(this.phaseCustomerList[s].customerId);this.customerListLoading=!1},getCustomerName:function(e){return this.investCustomerList.find(function(t){return t.customerId===e}).customerName},showUpdatePhaseDialog:function(e){this.dialogFormVisible=!0,this.tempPhase.phaseId=e.phaseId,this.tempPhase.projectId=e.projectId,this.tempPhase.phase=e.phase,this.tempPhase.establishTime=e.establishTime,this.tempPhase.payTime=e.payTime},updatePhase:function(){var e=this;this.$refs.tempPhase.validate(function(t){t&&(e.btnLoading=!0,Object(r.e)(e.tempPhase).then(function(t){200===t.returnCode?(e.$message.success("更新成功!"),e.getPhaseByProjectId(),e.dialogFormVisible=!1,e.btnLoading=!1):(console.error(t),e.$message.error(t.message),e.getPhaseByProjectId(),e.dialogFormVisible=!1,e.btnLoading=!1)}).catch(function(t){console.error(t),e.$message.error(t.message),e.getPhaseByProjectId(),e.dialogFormVisible=!1,e.btnLoading=!1}))})},deletePhase:function(e,t,s){var a=this;this.$confirm("您确认要删除该项目的第 "+s+" 期吗?","Warning",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(r.b)(e,t,s).then(function(e){200===e.returnCode?(a.$message.success("删除第"+s+"期成功！"),a.getPhaseByProjectId()):(a.$message.error(e.message),a.getPhaseByProjectId())})})}}},i=s("KHd+"),l=Object(i.a)(n,function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"app-container"},[s("div",{staticClass:"filter-container"},[s("el-row",[s("el-col",{attrs:{span:24}},[s("el-form",{staticClass:"demo-ruleForm"},[s("el-form-item",{attrs:{label:"选择项目"}},[s("el-select",{staticStyle:{width:"50%"},attrs:{filterable:"",placeholder:"请选择"},on:{change:function(t){return e.getPhaseByProjectId()}},model:{value:e.projectId,callback:function(t){e.projectId=t},expression:"projectId"}},e._l(e.allProjectList,function(e){return s("el-option",{key:e.projectId,attrs:{label:e.projectName,value:e.projectId}})}),1)],1),e._v(" "),s("el-form-item",{attrs:{label:"期数详情"}},[s("router-link",{attrs:{to:"/phase/create/"+this.projectId}},[this.projectId?s("el-button",{staticStyle:{float:"right"},attrs:{type:"info",size:"small",icon:"el-icon-plus"}},[e._v("新建一期")]):e._e()],1),e._v(" "),s("el-table",{directives:[{name:"loading",rawName:"v-loading.body",value:e.listLoading,expression:"listLoading",modifiers:{body:!0}}],staticStyle:{width:"100%"},attrs:{data:e.phaseList,"row-style":{height:0},"cell-style":{padding:0},"element-loading-text":"全力加载中...",border:"",fit:"","highlight-current-row":""}},[s("el-table-column",{attrs:{label:"期数",align:"center",sortable:"",prop:"phase"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",[e._v("第 "+e._s(t.row.phase)+" 期")])]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"成立时间",align:"center",sortable:"",prop:"establishTime"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",{domProps:{textContent:e._s(t.row.establishTime)}})]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"付息时间",align:"center",sortable:"",prop:"payTime"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",{domProps:{textContent:e._s(t.row.payTime)}})]}}])}),e._v(" "),e.hasPermission("phase:update")||e.hasPermission("phase:delete")?s("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.hasPermission("phase:update")?s("el-button",{attrs:{type:"text",icon:"el-icon-edit-outline circle"},nativeOn:{click:function(s){return s.preventDefault(),e.showUpdatePhaseDialog(t.row)}}},[e._v("更新\n                  ")]):e._e(),e._v(" "),e.hasPermission("phase:delete")?s("el-button",{attrs:{type:"text",icon:"el-icon-delete"},nativeOn:{click:function(s){return s.preventDefault(),e.deletePhase(t.row.phaseId,t.row.projectId,t.row.phase)}}},[e._v("删除\n                  ")]):e._e()]}}])}):e._e()],1)],1)],1),e._v(" "),e.phaseList&&e.phaseList.length>0?s("div",[s("el-steps",{attrs:{active:1,simple:""}},[s("el-step",{attrs:{title:"项目期数",icon:"el-icon-collection-tag"}}),e._v(" "),s("el-step",{attrs:{title:"该期客户",icon:"el-icon-s-custom"}})],1),e._v(" "),s("el-container",[s("el-aside",{attrs:{width:"160px"}},[s("br"),e._v(" "),s("el-menu",{attrs:{mode:"vertical"}},e._l(e.phaseList,function(t,a){return s("el-menu-item",{key:a,on:{click:function(s){e.phase=t.phase,e.getCustomersInPhase()}}},[s("i",{staticClass:"el-icon-collection-tag"}),e._v(" "),s("span",{attrs:{slot:"title"},slot:"title"},[e._v("第 "+e._s(t.phase)+" 期")])])}),1)],1),e._v(" "),s("el-main",[s("el-table",{directives:[{name:"loading",rawName:"v-loading.body",value:e.customerListLoading,expression:"customerListLoading",modifiers:{body:!0}}],staticStyle:{width:"100%"},attrs:{data:e.phaseCustomerList,"element-loading-text":"全力加载中...",border:"",stripe:"",fit:"","highlight-current-row":""}},[s("el-table-column",{attrs:{label:"客户姓名",align:"center",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[s("i",{staticClass:"el-icon-s-custom"}),e._v(" "),s("span",{domProps:{textContent:e._s(t.row.customerName)}})]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"身份证号","min-width":"100%",align:"center",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[s("i",{staticClass:"el-icon-document"}),e._v(" "),s("span",{domProps:{textContent:e._s(t.row.customerIdCard)}})]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"投资金额",align:"center",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[s("i",{staticClass:"el-icon-money"}),e._v(" "),s("span",[e._v(e._s(t.row.investMoney)+" 元")])]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"投资时间",align:"center",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[s("i",{staticClass:"el-icon-time"}),e._v(" "),s("span",{domProps:{textContent:e._s(t.row.investTime)}})]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"利率","min-width":"50%",align:"center",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[s("i",{staticClass:"el-icon-coin"}),e._v(" "),s("span",{domProps:{textContent:e._s(t.row.rate)}})]}}])}),e._v(" "),e.hasPermission("phase:update")||e.hasPermission("phase:delete")?s("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.hasPermission("phase:update")?s("el-button",{attrs:{type:"text",icon:"el-icon-delete"},nativeOn:{click:function(e){e.preventDefault()}}},[e._v("删除\n                    ")]):e._e()]}}])}):e._e()],1)],1)],1)],1):s("div",[e.projectId?s("el-tag",{attrs:{effect:"dark",type:"danger"}},[e._v("该项目一期都还没有成立哦")]):s("el-tag",{attrs:{effect:"dark",type:"danger"}},[e._v("请先选择项目")])],1)],1)],1),e._v(" "),s("el-dialog",{attrs:{title:"更新该期",visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[s("el-form",{ref:"tempPhase",staticClass:"small-space",staticStyle:{width:"300px","margin-left":"50px"},attrs:{"status-icon":"","label-position":"right","label-width":"100px",model:e.tempPhase,rules:e.createRules}},[s("el-form-item",{attrs:{label:"期数",prop:"phase"}},[s("el-input",{attrs:{type:"text","prefix-icon":"el-icon-info","auto-complete":"off",readonly:!0},model:{value:e.tempPhase.phase,callback:function(t){e.$set(e.tempPhase,"phase",t)},expression:"tempPhase.phase"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"成立时间",prop:"establishTime"}},[s("div",{staticClass:"block"},[s("el-date-picker",{attrs:{type:"date",placeholder:"选择日期","value-format":"yyyy-MM-dd",format:"yyyy-MM-dd"},model:{value:e.tempPhase.establishTime,callback:function(t){e.$set(e.tempPhase,"establishTime",t)},expression:"tempPhase.establishTime"}})],1)]),e._v(" "),s("el-form-item",{attrs:{label:"付款时间",prop:"payTime"}},[s("div",{staticClass:"block"},[s("el-date-picker",{attrs:{type:"date",placeholder:"选择日期","value-format":"yyyy-MM-dd",format:"yyyy-MM-dd"},model:{value:e.tempPhase.payTime,callback:function(t){e.$set(e.tempPhase,"payTime",t)},expression:"tempPhase.payTime"}})],1)])],1),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{staticStyle:{float:"left"},attrs:{type:"warning",icon:"el-icon-error"},on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取消")]),e._v(" "),s("el-button",{staticStyle:{float:"left"},attrs:{type:"danger",icon:"el-icon-refresh"},on:{click:function(t){return e.$refs.tempPhase.resetFields()}}},[e._v("重置\n        ")]),e._v(" "),s("el-button",{attrs:{type:"primary",loading:e.btnLoading,icon:"el-icon-success"},nativeOn:{click:function(t){return t.preventDefault(),e.updatePhase()}}},[e._v("更新\n        ")])],1)],1)],1)])},[],!1,null,"1e1ecfe3",null);t.default=l.exports},i7jY:function(e,t,s){"use strict";s.d(t,"a",function(){return r}),s.d(t,"d",function(){return o}),s.d(t,"c",function(){return n}),s.d(t,"b",function(){return i});var a=s("t3Un");function r(e){return Object(a.a)({url:"/projectCustomer/insert",method:"post",data:e})}function o(e){return Object(a.a)({url:"/projectCustomer/getInvestCustomersByProjectId",method:"get",params:{projectId:e}})}function n(e,t){return Object(a.a)({url:"/projectCustomer/getCustomersInProjectPhase",method:"get",params:{projectId:e,phase:t}})}function i(e){return Object(a.a)({url:"/projectCustomer/getCustomerInvestProject",method:"get",params:{customerId:e}})}}}]);
//# sourceMappingURL=13.ff7a0008b4b26b19ef9f.js.map