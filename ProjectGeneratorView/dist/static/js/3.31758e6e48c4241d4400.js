(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{"+NnE":function(t,e,r){"use strict";r.d(e,"a",function(){return a}),r.d(e,"c",function(){return o}),r.d(e,"d",function(){return n}),r.d(e,"e",function(){return c}),r.d(e,"b",function(){return i});var s=r("t3Un");function a(t){return Object(s.a)({url:"/projectPhase/insert",method:"post",data:t})}function o(t){return Object(s.a)({url:"/projectPhase/getProjectPhaseList",method:"get",params:{projectId:t}})}function n(t){return Object(s.a)({url:"/projectPhase/getProjectPhaseTotal",method:"get",params:{projectId:t}})}function c(t){return Object(s.a)({url:"/projectPhase/updatePhase",method:"post",data:t})}function i(t,e,r){return Object(s.a)({url:"/projectPhase/deletePhase",method:"get",params:{phaseId:t,projectId:e,phase:r}})}},Dv0d:function(t,e,r){"use strict";var s=r("M4vg");r.n(s).a},JNL0:function(t,e,r){"use strict";r.d(e,"d",function(){return a}),r.d(e,"e",function(){return o}),r.d(e,"f",function(){return n}),r.d(e,"a",function(){return c}),r.d(e,"h",function(){return i}),r.d(e,"b",function(){return u}),r.d(e,"c",function(){return d}),r.d(e,"g",function(){return l});var s=r("t3Un");function a(){return Object(s.a)({url:"/project/getAllProjects",method:"get"})}function o(t){return Object(s.a)({url:"/project/getProjectById",method:"get",params:{projectId:t}})}function n(t){return Object(s.a)({url:"/project/getProjectDetailById",method:"get",params:{projectId:t}})}function c(t){return Object(s.a)({url:"/project/insert",method:"post",data:t})}function i(t){return Object(s.a)({url:"/project/update",method:"post",data:t})}function u(t){return Object(s.a)({url:"/project/deleteProjectById",method:"get",params:{projectId:t}})}function d(t){return Object(s.a)({url:"/rateRange/deleteRateRange",method:"get",params:{rateRangeId:t}})}function l(t,e){return Object(s.a)({url:"/rateRange/getRateRange",method:"get",params:{projectId:t,investMoney:e}})}},M4vg:function(t,e,r){},XGl8:function(t,e,r){"use strict";r.r(e);var s=r("P2sY"),a=r.n(s),o=r("JNL0"),n=r("+NnE"),c=r("i7jY"),i={phaseId:"",projectId:"",phase:"",establishTime:"",payTime:"",customerInPhaseList:[]},u={components:{},data:function(){return{projectId:"",projectName:"",phaseForm:a()({},i),btnLoading:!1,investCustomerList:[],customerInPhaseList:[],customerWithNameList:[],selectedCustomerList:[],rules:{establishTime:[{required:!0,trigger:"blur",message:"请选择该期成立时间"}],payTime:[{required:!0,trigger:"blur",message:"请选择付息时间"}]}}},created:function(){this.hasPermission("phase:insert")&&(this.projectId=this.$route.params&&this.$route.params.id,this.phaseForm=a()({},i),this.getProjectName(this.projectId),this.getNewPhase(this.projectId),this.getInvestCustomersByProjectId(this.projectId))},methods:{getProjectName:function(t){var e=this;Object(o.e)(t).then(function(t){200===t.returnCode?e.projectName=t.data.projectName:e.$message.error("获取项目名称失败，请刷新")})},getNewPhase:function(t){var e=this;Object(n.d)(t).then(function(t){200===t.returnCode?e.phaseForm.phase=t.data+1:e.$message.error("获取项目期数失败，请刷新重试")})},submitForm:function(){var t=this;this.phaseForm.projectId=this.projectId;for(var e=[],r=0;r<this.selectedCustomerList.length;r++){var s={id:"",phase:this.phaseForm.phase,projectId:this.projectId,customerIdCard:this.selectedCustomerList[r]};e.push(s)}this.phaseForm.customerInPhaseList=e,this.$refs.phaseForm.validate(function(e){if(!e)return console.log("error submit!!"),!1;t.createPhase(t.phaseForm)})},getInvestCustomersByProjectId:function(t){var e=this;Object(c.c)(t,-1).then(function(r){e.customerInPhaseList=r.data,Object(c.d)(t).then(function(t){200===t.returnCode?(e.customerWithNameList=t.data,e.customerInPhaseList.forEach(function(t,r){var s=e.getCustomerName(t.customerId);e.investCustomerList.push({label:s,phase:-1!==t.phase?"第"+t.phase+"期":"未录入",key:t.customerIdCard})})):e.$message.error("获取客户列表失败，请刷新重试")})})},getCustomerName:function(t){return this.customerWithNameList.find(function(e){return e.customerId===t}).customerName},createPhase:function(t){var e=this;this.btnLoading=!0,Object(n.a)(t).then(function(t){200===t.returnCode?(e.$message.success("新建成功"),e.$router.push({name:"期数管理",params:{projectId:e.projectId}}),e.btnLoading=!1):(e.$message.error(t.message),console.error(t),e.btnLoading=!1)}).catch(function(t){console.error(t),e.$message.error(t.message),e.btnLoading=!1})}}},d=(r("Dv0d"),r("KHd+")),l=Object(d.a)(u,function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"app-container"},[r("div",{staticClass:"filter-container"},[r("el-row",[r("el-col",{attrs:{span:22,offset:1}},[r("el-card",{staticStyle:{"margin-top":"2%"},attrs:{shadow:"hover"}},[r("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[r("h3",{staticStyle:{"text-align":"center"}},[t._v(t._s(t.projectName))]),t._v(" "),r("el-tag",{staticStyle:{"font-size":"16px"},attrs:{effect:"dark",type:"primary"}},[t._v("新建一期")]),t._v(" "),r("router-link",{attrs:{to:"/project/index"}},[r("el-button",{staticStyle:{float:"right",padding:"8px 10px"},attrs:{type:"info",icon:"el-icon-back"}},[t._v("返回列表")])],1)],1),t._v(" "),r("div",[r("el-form",{ref:"phaseForm",attrs:{model:t.phaseForm,rules:t.rules,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"期数",prop:"phase"}},[r("el-button",{domProps:{textContent:t._s(t.phaseForm.phase)}})],1),t._v(" "),r("el-form-item",{attrs:{label:"成立时间",prop:"establishTime"}},[r("el-row",[r("el-col",{attrs:{span:22}},[r("div",{staticClass:"block"},[r("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"选择日期","value-format":"yyyy-MM-dd",format:"yyyy-MM-dd"},model:{value:t.phaseForm.establishTime,callback:function(e){t.$set(t.phaseForm,"establishTime",e)},expression:"phaseForm.establishTime"}})],1)])],1)],1),t._v(" "),r("el-form-item",{attrs:{label:"付款时间",prop:"payTime"}},[r("el-row",[r("el-col",{attrs:{span:22}},[r("div",{staticClass:"block"},[r("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"选择日期","value-format":"yyyy-MM-dd",format:"yyyy-MM-dd"},model:{value:t.phaseForm.payTime,callback:function(e){t.$set(t.phaseForm,"payTime",e)},expression:"phaseForm.payTime"}})],1)])],1)],1),t._v(" "),r("el-form-item",{attrs:{label:"选择客户"}},[r("el-transfer",{attrs:{filterable:"","filter-placeholder":"请输入客户姓名",titles:["该项目投资客户","该期客户"],data:t.investCustomerList},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.option;return r("div",{},[r("el-tooltip",{attrs:{effect:"dark",content:s.key,placement:"top-start"}},[r("el-row",{attrs:{gutter:20,display:"flex",justify:"space-between"}},[r("el-col",{attrs:{span:10}},[r("span",[t._v(t._s(s.label))])]),t._v(" "),r("el-col",{attrs:{span:10}},[r("span",[t._v(t._s(s.phase))])])],1)],1)],1)}}]),model:{value:t.selectedCustomerList,callback:function(e){t.selectedCustomerList=e},expression:"selectedCustomerList"}})],1),t._v(" "),r("el-form-item",[r("el-button",{attrs:{type:"warning",icon:"el-icon-refresh-left"},on:{click:function(e){return t.resetForm("phaseForm")}}},[t._v("重置")]),t._v(" "),r("el-button",{attrs:{type:"primary",icon:"el-icon-check",loading:t.btnLoading},on:{click:function(e){return t.submitForm()}}},[t._v("保存\n                ")])],1)],1)],1)])],1)],1)],1)])},[],!1,null,null,null);e.default=l.exports},i7jY:function(t,e,r){"use strict";r.d(e,"a",function(){return a}),r.d(e,"d",function(){return o}),r.d(e,"c",function(){return n}),r.d(e,"b",function(){return c});var s=r("t3Un");function a(t){return Object(s.a)({url:"/projectCustomer/insert",method:"post",data:t})}function o(t){return Object(s.a)({url:"/projectCustomer/getInvestCustomersByProjectId",method:"get",params:{projectId:t}})}function n(t,e){return Object(s.a)({url:"/projectCustomer/getCustomersInProjectPhase",method:"get",params:{projectId:t,phase:e}})}function c(t){return Object(s.a)({url:"/projectCustomer/getCustomerInvestProject",method:"get",params:{customerId:t}})}}}]);
//# sourceMappingURL=3.31758e6e48c4241d4400.js.map